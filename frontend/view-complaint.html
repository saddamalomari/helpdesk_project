<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>تفاصيل الشكوى - لوحة المدير</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f4f7f6; margin: 0; padding: 20px; }
        .container { max-width: 800px; margin: auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        .detail-row { margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #eee; }
        .label { font-weight: bold; color: #7f8c8d; display: block; }
        .value { font-size: 1.1em; color: #2c3e50; }
        .badge { padding: 5px 12px; border-radius: 20px; color: white; font-size: 0.9em; }
        .status-new { background: #3498db; }
        .status-completed { background: #2ecc71; }
        .back-btn { display: inline-block; margin-bottom: 20px; color: #3498db; text-decoration: none; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <a href="all-complaints.html" class="back-btn"><i class="fas fa-arrow-right"></i> العودة للقائمة</a>
        <h1 id="complaint-id-title">شكوى رقم #</h1>
        
        <div id="loading">جاري تحميل البيانات...</div>
        
        <div id="details-content" style="display:none;">
            <div class="detail-row"><span class="label">الحالة:</span> <span id="comp-status" class="badge"></span></div>
            <div class="detail-row"><span class="label">نوع الشكوى:</span> <span id="comp-type" class="value"></span></div>
            <div class="detail-row"><span class="label">اسم المشتكي:</span> <span id="comp-name" class="value"></span></div>
            <div class="detail-row"><span class="label">رقم الهاتف:</span> <span id="comp-phone" class="value"></span></div>
            <div class="detail-row"><span class="label">المكان:</span> <span id="comp-location" class="value"></span></div>
            <div class="detail-row"><span class="label">الوصف:</span> <p id="comp-desc" class="value"></p></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('token') || localStorage.getItem('userToken');
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');

            if (!id || !token) {
                alert("بيانات غير كافية");
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch(`/api/complaints/${id}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('complaint-id-title').innerText = `تفاصيل الشكوى TIC_${data.id}`;
                    document.getElementById('comp-status').innerText = data.status;
                    document.getElementById('comp-status').className = `badge status-${data.status}`;
                    document.getElementById('comp-type').innerText = data.complaint_type;
                    document.getElementById('comp-name').innerText = data.full_name;
                    document.getElementById('comp-phone').innerText = data.phone;
                    document.getElementById('comp-location').innerText = `${data.province} - ${data.area}`;
                    document.getElementById('comp-desc').innerText = data.description;

                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('details-content').style.display = 'block';
                }
            } catch (err) {
                console.error("خطأ في الجلب:", err);
            }
        });
    </script>
</body>
</html>